{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Hari\\\\OneDrive\\\\Desktop\\\\elevator_project\\\\frontend\\\\src\\\\ChatBox.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport axios from \"axios\";\nimport ChatMessage from \"./ChatMessage\";\n\n// --- CONFIGURATION ---\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst BACKEND_URL = \"http://localhost:8000\";\nconst EXPERT_ID = \"TECH_1001\"; // Placeholder ID, should come from user context later\n// ---\n\nexport default function ChatBox({\n  initialLog,\n  onNewLog\n}) {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const messagesRef = useRef(null);\n\n  // 1. Load initial log content when selected from the side panel\n  useEffect(() => {\n    if (initialLog) {\n      // Start with the user's query as the first message\n      const queryMessage = {\n        role: \"user\",\n        text: initialLog.title\n      };\n      // Followed by the AI response steps\n      const aiResponseMessage = {\n        role: \"ai\",\n        text: initialLog.fix.join(\"\\n\"),\n        steps: initialLog.fix\n      };\n      setMessages([queryMessage, aiResponseMessage]);\n    } else {\n      // Start fresh for a new query\n      setMessages([]);\n    }\n  }, [initialLog]);\n\n  // Scroll to the bottom on new messages\n  useEffect(() => {\n    if (messagesRef.current) {\n      messagesRef.current.scrollTop = messagesRef.current.scrollHeight;\n    }\n  }, [messages]);\n  async function persistLog(query, steps) {\n    try {\n      const logData = {\n        expert_id: EXPERT_ID,\n        query: query,\n        response: steps // FastAPI expects a list of strings\n      };\n\n      // POST to the FastAPI endpoint\n      const res = await axios.post(`${BACKEND_URL}/api/store_log`, logData);\n\n      // Notify ChatPage to refresh its list\n      if (onNewLog && res.data.status === \"success\") {\n        onNewLog();\n      }\n    } catch (err) {\n      console.error(\"Error saving log:\", err);\n    }\n  }\n  async function sendQuery(e) {\n    e.preventDefault();\n    if (!input.trim() || isLoading) return;\n    const userQuery = input.trim();\n    setMessages(prev => [...prev, {\n      role: \"user\",\n      text: userQuery\n    }]);\n    setInput(\"\");\n    setIsLoading(true);\n\n    // 1. Simulate AI processing and response\n    const steps = generateDemoSteps(userQuery);\n\n    // 2. Display AI response after a delay\n    setTimeout(async () => {\n      setIsLoading(false);\n      setMessages(prev => {\n        // The AI response contains all steps, formatted for display\n        const aiMessage = {\n          role: \"ai\",\n          text: steps.join(\"\\n\"),\n          steps\n        };\n        // Persist the entire conversation (user query + AI response)\n        persistLog(userQuery, steps);\n        return [...prev, aiMessage];\n      });\n    }, 700);\n  }\n\n  // Existing demo function (unchanged)\n  function generateDemoSteps(q) {\n    // ... (Your existing generateDemoSteps logic)\n    if (/door/i.test(q)) return [\"Step 1: Check door tracks and clear any obstruction.\", \"Step 2: Lubricate the guides and test door motor.\", \"Step 3: Inspect limit switches and sensors.\"];\n    if (/sensor/i.test(q)) return [\"Step 1: Power off and inspect sensor connectors.\", \"Step 2: Clean the sensor lens.\", \"Step 3: Replace the sensor if readings are inconsistent.\"];\n    return [\"Step 1: Check wiring and power supply.\", \"Step 2: Verify control board connections.\", \"Step 3: Test the motor relay.\"];\n  }\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [\"\\xA0 \\xA0 \\xA0 \", /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages\",\n      ref: messagesRef,\n      children: [\"\\xA0 \\xA0 \\xA0 \\xA0 \", messages.map((m, i) => /*#__PURE__*/_jsxDEV(ChatMessage, {\n        message: m\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 11\n      }, this)), \"\\xA0 \\xA0 \\xA0 \\xA0 \", isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"message ai-message\",\n        children: \"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 Thinking... \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }, this), \"\\xA0 \\xA0 \\xA0 \"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this), \"\\xA0 \\xA0 \\xA0 \", /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"chat-input\",\n      onSubmit: sendQuery,\n      children: [\"\\xA0 \\xA0 \\xA0 \\xA0 \", /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Type your query...\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        disabled: isLoading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this), \"\\xA0 \\xA0 \\xA0 \\xA0 \", /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        type: \"submit\",\n        disabled: isLoading,\n        children: \"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 Send \\xA0 \\xA0 \\xA0 \\xA0 \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this), \"\\xA0 \\xA0 \\xA0 \"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), \"\\xA0 \\xA0 \"]\n  }, void 0, true);\n}\n_s(ChatBox, \"sF2KxnQY79ZJMfoxSEP+NqdH85o=\");\n_c = ChatBox;\nvar _c;\n$RefreshReg$(_c, \"ChatBox\");","map":{"version":3,"names":["React","useEffect","useRef","useState","axios","ChatMessage","jsxDEV","_jsxDEV","Fragment","_Fragment","BACKEND_URL","EXPERT_ID","ChatBox","initialLog","onNewLog","_s","messages","setMessages","input","setInput","isLoading","setIsLoading","messagesRef","queryMessage","role","text","title","aiResponseMessage","fix","join","steps","current","scrollTop","scrollHeight","persistLog","query","logData","expert_id","response","res","post","data","status","err","console","error","sendQuery","e","preventDefault","trim","userQuery","prev","generateDemoSteps","setTimeout","aiMessage","q","test","children","className","ref","map","m","i","message","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","type","placeholder","value","onChange","target","disabled","_c","$RefreshReg$"],"sources":["C:/Users/Hari/OneDrive/Desktop/elevator_project/frontend/src/ChatBox.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport ChatMessage from \"./ChatMessage\";\r\n\r\n// --- CONFIGURATION ---\r\nconst BACKEND_URL = \"http://localhost:8000\";\r\nconst EXPERT_ID = \"TECH_1001\"; // Placeholder ID, should come from user context later\r\n// ---\r\n\r\nexport default function ChatBox({ initialLog, onNewLog }) {\r\n const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const messagesRef = useRef(null);\r\n\r\n  // 1. Load initial log content when selected from the side panel\r\n  useEffect(() => {\r\n    if (initialLog) {\r\n      // Start with the user's query as the first message\r\n      const queryMessage = { role: \"user\", text: initialLog.title };\r\n      // Followed by the AI response steps\r\n      const aiResponseMessage = { \r\n        role: \"ai\", \r\n        text: initialLog.fix.join(\"\\n\"), \r\n        steps: initialLog.fix \r\n      };\r\n      setMessages([queryMessage, aiResponseMessage]);\r\n    } else {\r\n      // Start fresh for a new query\r\n      setMessages([]);\r\n    }\r\n  }, [initialLog]);\r\n\r\n  // Scroll to the bottom on new messages\r\n  useEffect(() => {\r\n    if (messagesRef.current) {\r\n      messagesRef.current.scrollTop = messagesRef.current.scrollHeight;\r\n    }\r\n  }, [messages]);\r\n\r\n\r\n  async function persistLog(query, steps) {\r\n    try {\r\n      const logData = {\r\n        expert_id: EXPERT_ID, \r\n        query: query,          \r\n        response: steps        // FastAPI expects a list of strings\r\n      };\r\n      \r\n      // POST to the FastAPI endpoint\r\n      const res = await axios.post(`${BACKEND_URL}/api/store_log`, logData);\r\n      \r\n      // Notify ChatPage to refresh its list\r\n      if (onNewLog && res.data.status === \"success\") {\r\n          onNewLog();\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error(\"Error saving log:\", err);\r\n    }\r\n  }\r\n\r\n  async function sendQuery(e) {\r\n    e.preventDefault();\r\n    if (!input.trim() || isLoading) return;\r\n\r\n    const userQuery = input.trim();\r\n    setMessages((prev) => [...prev, { role: \"user\", text: userQuery }]);\r\n    setInput(\"\");\r\n    setIsLoading(true);\r\n\r\n    // 1. Simulate AI processing and response\r\n    const steps = generateDemoSteps(userQuery);\r\n    \r\n    // 2. Display AI response after a delay\r\n    setTimeout(async () => {\r\n      setIsLoading(false);\r\n        \r\n      setMessages((prev) => {\r\n        // The AI response contains all steps, formatted for display\r\n        const aiMessage = { role: \"ai\", text: steps.join(\"\\n\"), steps };\r\n        // Persist the entire conversation (user query + AI response)\r\n        persistLog(userQuery, steps); \r\n        return [...prev, aiMessage];\r\n      });\r\n    }, 700);\r\n  }\r\n  \r\n  // Existing demo function (unchanged)\r\n  function generateDemoSteps(q) {\r\n    // ... (Your existing generateDemoSteps logic)\r\n    if (/door/i.test(q))\r\n      return [\r\n        \"Step 1: Check door tracks and clear any obstruction.\",\r\n        \"Step 2: Lubricate the guides and test door motor.\",\r\n        \"Step 3: Inspect limit switches and sensors.\",\r\n      ];\r\n    if (/sensor/i.test(q))\r\n      return [\r\n        \"Step 1: Power off and inspect sensor connectors.\",\r\n        \"Step 2: Clean the sensor lens.\",\r\n        \"Step 3: Replace the sensor if readings are inconsistent.\",\r\n      ];\r\n    return [\r\n      \"Step 1: Check wiring and power supply.\",\r\n      \"Step 2: Verify control board connections.\",\r\n      \"Step 3: Test the motor relay.\",\r\n    ];\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"messages\" ref={messagesRef}>\r\n        {messages.map((m, i) => (\r\n          <ChatMessage key={i} message={m} />\r\n        ))}\r\n        {isLoading && (\r\n          <div className=\"message ai-message\">\r\n            Thinking...\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <form className=\"chat-input\" onSubmit={sendQuery}>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Type your query...\"\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          disabled={isLoading}\r\n        />\r\n        <button className=\"btn\" type=\"submit\" disabled={isLoading}>\r\n          Send\r\n        </button>\r\n      </form>\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}