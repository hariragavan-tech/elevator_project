{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Hari\\\\OneDrive\\\\Desktop\\\\elevator_project\\\\frontend\\\\src\\\\ChatBox.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport axios from \"axios\";\nimport ChatMessage from \"./ChatMessage\";\n\n// --- CONFIGURATION ---\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst BACKEND_URL = \"http://localhost:8001\";\n// NOTE: The EXPERT_ID constant is REMOVED. It MUST be passed via props now.\n// ---\n\n// ðŸ‘ˆ Component now expects 'expertId' to be passed from the parent component\nexport default function ChatBox({\n  initialLog,\n  onNewLog,\n  expertId\n}) {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const messagesRef = useRef(null);\n\n  // CRITICAL: Prevent execution if the user's ID is missing (not logged in)\n  useEffect(() => {\n    if (!expertId) {\n      console.warn(\"ChatBox is active but no expertId is provided. Chatting is disabled.\");\n    }\n  }, [expertId]);\n\n  // 1. Load initial log content when selected from the side panel\n  useEffect(() => {\n    if (initialLog) {\n      // Start with the user's query as the first message\n      const queryMessage = {\n        role: \"user\",\n        text: initialLog.title\n      };\n      // Followed by the AI response steps\n      const aiResponseMessage = {\n        role: \"ai\",\n        text: initialLog.fix.join(\"\\n\"),\n        steps: initialLog.fix\n      };\n      setMessages([queryMessage, aiResponseMessage]);\n    } else {\n      // Start fresh for a new query\n      setMessages([]);\n    }\n  }, [initialLog]);\n\n  // Scroll to the bottom on new messages\n  useEffect(() => {\n    if (messagesRef.current) {\n      messagesRef.current.scrollTop = messagesRef.current.scrollHeight;\n    }\n  }, [messages]);\n  async function persistLog(userQuery, aiResponseText) {\n    // Safety check: Don't save if we don't know who is saving it.\n    if (!expertId) return;\n    try {\n      const logId = crypto.randomUUID();\n\n      // Construct payload with correct field names and mandatory fields\n      const logData = {\n        expert_id: expertId,\n        // ðŸ‘ˆ USING DYNAMIC PROP HERE\n        user_query: userQuery,\n        ai_response: aiResponseText,\n        status: \"completed\",\n        timestamp: new Date().toISOString(),\n        log_id: logId\n      };\n\n      // POST to the FastAPI endpoint\n      const res = await axios.post(`${BACKEND_URL}/api/store_log`, logData);\n\n      // Notify ChatPage to refresh its list\n      if (onNewLog && res.status === 200) {\n        onNewLog();\n      }\n    } catch (err) {\n      console.error(\"Error saving log:\", err.response ? err.response.data : err.message);\n    }\n  }\n  async function sendQuery(e) {\n    e.preventDefault();\n    if (!input.trim() || isLoading || !expertId) return; // ðŸ‘ˆ Disabled if no expertId\n\n    const userQuery = input.trim();\n    setMessages(prev => [...prev, {\n      role: \"user\",\n      text: userQuery\n    }]);\n    setInput(\"\");\n    setIsLoading(true);\n    const steps = generateDemoSteps(userQuery);\n    const aiResponseText = steps.join(\"\\n\");\n    setTimeout(async () => {\n      setIsLoading(false);\n      setMessages(prev => {\n        const aiMessage = {\n          role: \"ai\",\n          text: aiResponseText,\n          steps\n        };\n        persistLog(userQuery, aiResponseText);\n        return [...prev, aiMessage];\n      });\n    }, 700);\n  }\n  function generateDemoSteps(q) {\n    if (/door/i.test(q)) return [\"Step 1: Check door tracks and clear any obstruction.\", \"Step 2: Lubricate the guides and test door motor.\", \"Step 3: Inspect limit switches and sensors.\"];\n    if (/sensor/i.test(q)) return [\"Step 1: Power off and inspect sensor connectors.\", \"Step 2: Clean the sensor lens.\", \"Step 3: Replace the sensor if readings are inconsistent.\"];\n    return [\"Step 1: Check wiring and power supply.\", \"Step 2: Verify control board connections.\", \"Step 3: Test the motor relay.\"];\n  }\n  const isInputDisabled = isLoading || !expertId;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages\",\n      ref: messagesRef,\n      children: [messages.map((m, i) => /*#__PURE__*/_jsxDEV(ChatMessage, {\n        message: m\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 11\n      }, this)), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"message ai-message\",\n        children: \"Thinking...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"chat-input\",\n      onSubmit: sendQuery,\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: expertId ? \"Type your query...\" : \"Please log in to start chatting.\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        disabled: isInputDisabled\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        type: \"submit\",\n        disabled: isInputDisabled,\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(ChatBox, \"ROu6dIKP6UOFZTHn3sbalyF89Ug=\");\n_c = ChatBox;\nvar _c;\n$RefreshReg$(_c, \"ChatBox\");","map":{"version":3,"names":["React","useEffect","useRef","useState","axios","ChatMessage","jsxDEV","_jsxDEV","Fragment","_Fragment","BACKEND_URL","ChatBox","initialLog","onNewLog","expertId","_s","messages","setMessages","input","setInput","isLoading","setIsLoading","messagesRef","console","warn","queryMessage","role","text","title","aiResponseMessage","fix","join","steps","current","scrollTop","scrollHeight","persistLog","userQuery","aiResponseText","logId","crypto","randomUUID","logData","expert_id","user_query","ai_response","status","timestamp","Date","toISOString","log_id","res","post","err","error","response","data","message","sendQuery","e","preventDefault","trim","prev","generateDemoSteps","setTimeout","aiMessage","q","test","isInputDisabled","children","className","ref","map","m","i","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","type","placeholder","value","onChange","target","disabled","_c","$RefreshReg$"],"sources":["C:/Users/Hari/OneDrive/Desktop/elevator_project/frontend/src/ChatBox.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport ChatMessage from \"./ChatMessage\";\r\n\r\n// --- CONFIGURATION ---\r\nconst BACKEND_URL = \"http://localhost:8001\";\r\n// NOTE: The EXPERT_ID constant is REMOVED. It MUST be passed via props now.\r\n// ---\r\n\r\n// ðŸ‘ˆ Component now expects 'expertId' to be passed from the parent component\r\nexport default function ChatBox({ initialLog, onNewLog, expertId }) {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const messagesRef = useRef(null);\r\n\r\n  // CRITICAL: Prevent execution if the user's ID is missing (not logged in)\r\n  useEffect(() => {\r\n    if (!expertId) {\r\n      console.warn(\"ChatBox is active but no expertId is provided. Chatting is disabled.\");\r\n    }\r\n  }, [expertId]);\r\n\r\n\r\n  // 1. Load initial log content when selected from the side panel\r\n  useEffect(() => {\r\n    if (initialLog) {\r\n      // Start with the user's query as the first message\r\n      const queryMessage = { role: \"user\", text: initialLog.title };\r\n      // Followed by the AI response steps\r\n      const aiResponseMessage = { \r\n        role: \"ai\", \r\n        text: initialLog.fix.join(\"\\n\"), \r\n        steps: initialLog.fix \r\n      };\r\n      setMessages([queryMessage, aiResponseMessage]);\r\n    } else {\r\n      // Start fresh for a new query\r\n      setMessages([]);\r\n    }\r\n  }, [initialLog]);\r\n\r\n  // Scroll to the bottom on new messages\r\n  useEffect(() => {\r\n    if (messagesRef.current) {\r\n      messagesRef.current.scrollTop = messagesRef.current.scrollHeight;\r\n    }\r\n  }, [messages]);\r\n\r\n\r\n  async function persistLog(userQuery, aiResponseText) {\r\n    // Safety check: Don't save if we don't know who is saving it.\r\n    if (!expertId) return; \r\n\r\n    try {\r\n      const logId = crypto.randomUUID(); \r\n\r\n      // Construct payload with correct field names and mandatory fields\r\n      const logData = {\r\n        expert_id: expertId, // ðŸ‘ˆ USING DYNAMIC PROP HERE\r\n        user_query: userQuery,      \r\n        ai_response: aiResponseText, \r\n        status: \"completed\",        \r\n        timestamp: new Date().toISOString(), \r\n        log_id: logId,              \r\n      };\r\n      \r\n      // POST to the FastAPI endpoint\r\n      const res = await axios.post(`${BACKEND_URL}/api/store_log`, logData);\r\n      \r\n      // Notify ChatPage to refresh its list\r\n      if (onNewLog && res.status === 200) {\r\n          onNewLog();\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error(\"Error saving log:\", err.response ? err.response.data : err.message);\r\n    }\r\n  }\r\n\r\n  async function sendQuery(e) {\r\n    e.preventDefault();\r\n    if (!input.trim() || isLoading || !expertId) return; // ðŸ‘ˆ Disabled if no expertId\r\n\r\n    const userQuery = input.trim();\r\n    setMessages((prev) => [...prev, { role: \"user\", text: userQuery }]);\r\n    setInput(\"\");\r\n    setIsLoading(true);\r\n\r\n    const steps = generateDemoSteps(userQuery);\r\n    const aiResponseText = steps.join(\"\\n\"); \r\n    \r\n    setTimeout(async () => {\r\n      setIsLoading(false);\r\n        \r\n      setMessages((prev) => {\r\n        const aiMessage = { role: \"ai\", text: aiResponseText, steps };\r\n        persistLog(userQuery, aiResponseText); \r\n        return [...prev, aiMessage];\r\n      });\r\n    }, 700);\r\n  }\r\n  \r\n  function generateDemoSteps(q) {\r\n    if (/door/i.test(q))\r\n      return [\r\n        \"Step 1: Check door tracks and clear any obstruction.\",\r\n        \"Step 2: Lubricate the guides and test door motor.\",\r\n        \"Step 3: Inspect limit switches and sensors.\",\r\n      ];\r\n    if (/sensor/i.test(q))\r\n      return [\r\n        \"Step 1: Power off and inspect sensor connectors.\",\r\n        \"Step 2: Clean the sensor lens.\",\r\n        \"Step 3: Replace the sensor if readings are inconsistent.\",\r\n      ];\r\n    return [\r\n      \"Step 1: Check wiring and power supply.\",\r\n      \"Step 2: Verify control board connections.\",\r\n      \"Step 3: Test the motor relay.\",\r\n    ];\r\n  }\r\n\r\n  const isInputDisabled = isLoading || !expertId;\r\n\r\n  return (\r\n    <>\r\n      <div className=\"messages\" ref={messagesRef}>\r\n        {messages.map((m, i) => (\r\n          <ChatMessage key={i} message={m} />\r\n        ))}\r\n        {isLoading && (\r\n          <div className=\"message ai-message\">\r\n            Thinking...\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <form className=\"chat-input\" onSubmit={sendQuery}>\r\n        <input\r\n          type=\"text\"\r\n          placeholder={expertId ? \"Type your query...\" : \"Please log in to start chatting.\"}\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          disabled={isInputDisabled}\r\n        />\r\n        <button className=\"btn\" type=\"submit\" disabled={isInputDisabled}>\r\n          Send\r\n        </button>\r\n      </form>\r\n    </>\r\n );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}